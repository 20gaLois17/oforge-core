{% extends 'Frontend/Layout.twig' %}


{% block master__footer_scripts %}
    {{ parent() }}

    {% set analyticsKey = config('analytics_tracking_id') %}
    {% if analyticsKey is not empty %}
    {# check if user has agreed and then start tracking #}
    <script>
        var cookie_consent = localStorage.getItem('cookie_consent');
        if (cookie_consent === "accepted") {
            let body = document.querySelector('body');
            let script = document.createElement('script');

            script.type = 'text/javascript';
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id={{ analyticsKey }}';

            body.appendChild(script);

            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', '{{ analyticsKey }}', {'anonymize_ip': true});
        }
    </script>
    {% endif %}

{% endblock master__footer_scripts %}

